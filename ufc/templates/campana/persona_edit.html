{% extends "base.html" %}
{% load mptt_tags %}
{% load bootstrap3 %}

{% block h1 %}Editar Persona{% endblock h1 %}
{% block content %}
    <div class="row">
        <form action="" method="post" class="form">
            {% csrf_token %}
            <div class="col-md-6">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title">Usuario del Sistema</h3>
                    </div>
                    <div class="panel-body">
                        {% bootstrap_form form_user %}
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <h3 class="panel-title">Estructura</h3>
                    </div>
                    <div class="panel-body">
                        {% bootstrap_form form %}
                        {% if form_grupo %}
                            <div class="panel panel-info">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Permiso</h3>
                                </div>
                                <div class="panel-body">
                                    {% bootstrap_form form_grupo %}
                                </div>
                            </div>
                        {% endif %}
                        {% buttons %}
                            <button type="submit" class="btn btn-warning" id="id_estructura">
                                {% bootstrap_icon "save" %} Guardar
                            </button>
                        {% endbuttons %}
                    </div>
                </div>
            </div>
        </form>
    </div>

{% endblock content %}


{% block extra_script %}
    <script type="application/javascript">

        $().ready(function(){
            $('#id_first_name').focus();
            $("#id_parent option[value='']").remove();
        });

        $("#id_username").change(function () {
            $.ajax({
                type: 'GET',
                url: '{% url 'campana:usuario_validar' %}',
                dataType: 'json',
                data: {
                    'username': $(this).val()
                },
                success: function (data) {
                    if (data.is_taken) {
                        $('#block-error').remove();
                        $('#id_username').closest('.form-group').addClass('has-error');
                        $('#id_username').closest('.form-group').append('<div id="block-error" class="help-block">'.concat(data.error_message,'</div>'));
                    }else{
                        $('#id_username').closest('.form-group').removeClass('has-error');
                        $('#id_username').closest('.form-group').addClass('has-success');
                        $('#block-error').remove();
                    }
                }
            });
        });
    </script>
{% endblock %}